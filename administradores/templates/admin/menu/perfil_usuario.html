<!-- administradores/templates/admin/menu/perfil_usuario.html -->
{% extends 'admin/admin.html' %}
{% load static %}

{% block title %}Perfil de Usuario - Sistema UNAM{% endblock %}

{% block extra_css %}
{{ block.super }}
    <link rel="stylesheet" href="{% static 'admin/css/perfil_usuarios.css' %}">
{% endblock %}

{% block content %}
<div class="perfil-container">

        <!-- Contenedor para mensajes dinámicos (arriba a la derecha) -->
    <div id="dynamicMessagesContainer" class="messages-container"></div>
    
    <!-- Mensajes de Django (si los hay) -->
    {% if messages %}
    <div id="djangoMessagesContainer" class="messages-container">
        {% for message in messages %}
        <div class="message {{ message.tags }}">
            <i class="fas fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
            <span>{{ message }}</span>
            <button class="message-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <!-- Header del perfil -->
    <!-- Header del perfil con Avatar -->
    <header class="perfil-header">
        <!-- Avatar Section -->
        <div class="avatar-section">
            <div class="user-avatar-container" onclick="document.getElementById('avatarInput').click()">
                <div class="user-avatar">
                    {% if usuario.icono_user %}
                        <img src="/perfiles/{{ usuario.icono_user|slice:'9:' }}" alt="Avatar" id="avatarImage">
                    {% else %}
                        <img src="{% static 'img/default-avatar.webp' %}" alt="Avatar" id="avatarImage">
                    {% endif %}
                    <div class="avatar-upload-overlay">
                        <i class="fas fa-camera"></i>
                        <span>Cambiar foto</span>
                    </div>
                </div>
            </div>
            <input type="file" id="avatarInput" accept="image/jpeg,image/png,image/jpg" onchange="uploadAvatar(this)">
            
            <div class="avatar-name">{{ usuario.nombre }} {{ usuario.apellido }}</div>
            <div class="avatar-email">{{ usuario.email }}</div>
        </div>
        
        <h1 class="perfil-titulo">Perfil de Usuario</h1>
        <p class="perfil-subtitulo">Sistema Académico UNAM</p>
        <span class="role-badge">
            {{ usuario.rol|upper }}
        </span>
    </header>


    <!-- Formulario de información personal con botón cancelar -->
    <section class="form-section">
         <h2 class="section-title">
        <i class="fas fa-user-circle"></i>
        <span class="section-title-text">Información Personal</span>
        <div class="section-title-controls">
            <button type="button" class="edit-toggle" id="editToggleBtn" onclick="toggleEdit('personalInfoForm', this)">
                <i class="fas fa-edit"></i> Editar Información
            </button>
            <div class="action-buttons" id="actionButtons" style="display: none;">
               
                <button type="button" class="btn btn-save" onclick="submitForm('personalInfoForm')">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </div>
    </h2>
        
        <form id="personalInfoForm" method="POST" action="{% url 'administradores:actualizar_perfil' %}">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ usuario.id }}">
            
            <div class="form-grid">
                <div class="form-group">
                    <label for="nombre">Nombre</label>
                    <input type="text" id="nombre" name="nombre" value="{{ usuario.nombre }}" disabled required>
                </div>
                
                <div class="form-group">
                    <label for="apellido">Apellido</label>
                    <input type="text" id="apellido" name="apellido" value="{{ usuario.apellido }}" disabled required>
                </div>
                
                <div class="form-group">
                    <label for="usuario">Nombre de Usuario</label>
                    <input type="text" id="usuario" name="usuario" value="{{ usuario.usuario }}" disabled required>
                </div>
                
                <div class="form-group">
                    <label for="email">Correo Electrónico</label>
                    <input type="email" id="email" name="email" value="{{ usuario.email }}" disabled required>
                </div>
                
                <div class="form-group">
                    <label for="telefono">Teléfono</label>
                    <input type="tel" id="telefono" name="telefono" value="{{ usuario.telefono }}" disabled 
                        pattern="[0-9]{10}" title="Debe tener 10 dígitos">
                </div>
                
                <div class="form-group">
                    <label for="numero_cuenta">Número de Cuenta</label>
                    <div class="readonly-field">
                        {{ usuario.numero_cuenta|default:"No asignado" }}
                    </div>
                </div>
            </div>
            
            <div class="form-actions" id="personalInfoActions" style="display: none;">
                <button type="button" class="btn btn-cancel" onclick="cancelEdit('personalInfoForm')">
                    <i class="fas fa-times"></i> Cancelar Cambios
                </button>
                <button type="button" class="btn btn-save" onclick="submitForm('personalInfoForm')">
                    <i class="fas fa-save"></i> Guardar Cambios
                </button>
            </div>
        </form>
    </section>

    <!-- Formulario de contraseña con iconos de visibilidad -->
    <section class="form-section">
        <h2 class="section-title">
            <i class="fas fa-lock"></i>
            Seguridad y Contraseña
        </h2>
        
        <form id="passwordForm" method="POST" action="{% url 'administradores:cambiar_password' %}">
            {% csrf_token %}
            <input type="hidden" name="user_id" value="{{ usuario.id }}">
            
            <div class="form-grid">
                <div class="form-group password-input-group">
                    <label for="nueva_password">Nueva Contraseña</label>
                    <input type="password" id="nueva_password" name="nueva_password" 
                        placeholder="Ingrese nueva contraseña" required>
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('nueva_password', this)">
                        <i class="fas fa-eye"></i>
                    </button>
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        <i class="fas fa-info-circle"></i> Mínimo 8 caracteres
                    </small>
                </div>
                
                <div class="form-group password-input-group">
                    <label for="confirmar_password">Confirmar Contraseña</label>
                    <input type="password" id="confirmar_password" name="confirmar_password" 
                        placeholder="Confirme la nueva contraseña" required>
                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('confirmar_password', this)">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="button" class="btn btn-cancel" onclick="resetPasswordForm()">
                    <i class="fas fa-times"></i> Limpiar Campos
                </button>
                <button type="button" class="btn btn-save" onclick="submitPasswordForm()">
                    <i class="fas fa-key"></i> Cambiar Contraseña
                </button>
            </div>
        </form>
    </section>

    <!-- Información del sistema -->
    <section class="form-section">
        <h2 class="section-title">
            <i class="fas fa-info-circle"></i>
            Información del Sistema
        </h2>
        
        <div class="form-grid">
            <div class="form-group">
                <label>Rol en el Sistema</label>
                <div class="readonly-field">
                    <i class="fas fa-user-tag" style="margin-right: 8px; color: var(--unam-azul);"></i>
                    {{ usuario.rol|title }}
                </div>
            </div>
            
            <div class="form-group">
                <label>Fecha de Registro</label>
                <div class="readonly-field">
                    <i class="fas fa-calendar-alt" style="margin-right: 8px; color: var(--unam-azul);"></i>
                    {{ usuario.fecha_creacion|date:"d/m/Y" }}
                </div>
            </div>
            
            <div class="form-group">
                <label>Institución</label>
                <div class="readonly-field">
                    <i class="fas fa-university" style="margin-right: 8px; color: var(--unam-azul);"></i>
                    Facultad de Estudios Superiores Cuatitlán
                </div>
            </div>
            
        </div>
    </section>

    <!-- Acciones disponibles -->
    <section class="acciones-section">
        <h2 class="section-title">
            <i class="fas fa-tasks"></i>
            Acciones Disponibles
        </h2>
        <div class="acciones-grid">
            {% for accion in acciones %}
            <a href="{% url accion.url %}" class="accion-card">
                <div class="accion-header">
                    <div class="accion-icon">
                        <i class="{{ accion.icono }}"></i>
                    </div>
                    <h3>{{ accion.nombre }}</h3>
                </div>
                <div class="accion-body">
                    <p>Acceder al módulo de {{ accion.nombre }}</p>
                </div>
            </a>
            {% empty %}
            <div class="no-acciones" style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <i class="fas fa-inbox" style="font-size: 50px; color: #ccc; margin-bottom: 20px;"></i>
                <p style="color: #888; font-size: 16px;">No hay acciones disponibles para tu rol.</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}

<script>
// Variables para almacenar valores originales
let originalValues = {};

// Función para alternar edición de formularios
function toggleEdit(formId, button) {
    const form = document.getElementById(formId);
    const inputs = form.querySelectorAll('input:not([type="hidden"])');
    const actionButtons = document.getElementById('actionButtons');
    
    if (!form.dataset.editing || form.dataset.editing === 'false') {
        // Activar edición
        originalValues[formId] = {};
        inputs.forEach(input => {
            // Habilitar TODOS los campos editables excepto el de número de cuenta
            if (input.id !== 'numero_cuenta') {
                originalValues[formId][input.id] = input.value;
                input.disabled = false;
                input.style.backgroundColor = 'white';
                input.style.borderColor = 'var(--unam-oro)';
                input.style.boxShadow = '0 0 0 3px rgba(198, 146, 20, 0.1)';
            }
        });
        
        // Cambiar texto del botón de editar
        button.innerHTML = '<i class="fas fa-times"></i> Cancelar Edición';
        button.classList.add('active');
        
        // Mostrar botones de acción
        if (actionButtons) {
            actionButtons.style.display = 'flex';
            actionButtons.style.animation = 'slideIn 0.3s ease-out';
        }
        
        form.dataset.editing = 'true';
    } else {
        // Desactivar edición
        cancelEdit(formId);
    }
}

// Función para cancelar edición
function cancelEdit(formId) {
    const form = document.getElementById(formId);
    const inputs = form.querySelectorAll('input:not([type="hidden"])');
    const editButton = document.getElementById('editToggleBtn');
    const actionButtons = document.getElementById('actionButtons');
    
    if (originalValues[formId]) {
        inputs.forEach(input => {
            if (originalValues[formId][input.id] !== undefined) {
                input.value = originalValues[formId][input.id];
            }
            input.disabled = true;
            input.style.backgroundColor = '';
            input.style.borderColor = '';
            input.style.boxShadow = '';
        });
    }
    
    // Restaurar botón de editar
    if (editButton) {
        editButton.innerHTML = '<i class="fas fa-edit"></i> Editar Información';
        editButton.classList.remove('active');
    }
    
    // Ocultar botones de acción
    if (actionButtons) {
        actionButtons.style.display = 'none';
    }
    
    form.dataset.editing = 'false';
}

// Función para enviar formulario de información personal
function submitForm(formId) {
    const form = document.getElementById(formId);
    const nombre = form.querySelector('#nombre').value.trim();
    const apellido = form.querySelector('#apellido').value.trim();
    const usuario = form.querySelector('#usuario').value.trim();
    const email = form.querySelector('#email').value.trim();
    const telefono = form.querySelector('#telefono').value.trim();
    
    // Validaciones
    if (!nombre || !apellido || !usuario || !email || !telefono) {
        alert('Todos los campos son obligatorios.');
        return;
    }
    
    if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
        alert('Por favor ingrese un correo electrónico válido.');
        return;
    }
    
    if (!/^[0-9]{10}$/.test(telefono)) {
        alert('El teléfono debe tener exactamente 10 dígitos.');
        return;
    }
    
    // Validar que se haya hecho algún cambio
    const hasChanges = Object.keys(originalValues[formId] || {}).some(key => {
        const input = form.querySelector(`#${key}`);
        return input && input.value !== originalValues[formId][key];
    });
    
    if (!hasChanges) {
        alert('No se detectaron cambios para guardar.');
        return;
    }
    
    // Confirmar antes de enviar
    if (confirm('¿Está seguro de que desea guardar los cambios en su información personal?')) {
        // Deshabilitar botones mientras se procesa
        const editButton = document.getElementById('editToggleBtn');
        const actionButtons = document.getElementById('actionButtons');
        
        if (editButton) editButton.disabled = true;
        if (actionButtons) {
            const saveBtn = actionButtons.querySelector('.btn-save');
            const cancelBtn = actionButtons.querySelector('.btn-cancel');
            if (saveBtn) saveBtn.disabled = true;
            if (cancelBtn) cancelBtn.disabled = true;
        }
        
        // Enviar formulario
        form.submit();
    }
}

// Inicialización cuando el DOM está listo
document.addEventListener('DOMContentLoaded', function() {
    console.log('Perfil de usuario cargado');
});
</script>



<script>
function uploadAvatar(input) {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Validar tipo de archivo
        if (!['image/jpeg', 'image/png', 'image/jpg'].includes(file.type)) {
            alert('Solo se permiten imágenes JPG, JPEG o PNG');
            return;
        }
        
        // Validar tamaño (máximo 10MB)
        if (file.size > 10 * 1024 * 1024) {
            alert('La imagen no debe superar 2MB');
            return;
        }
        
        const formData = new FormData();
        formData.append('avatar', file);
        formData.append('user_id', '{{ usuario.id }}');
        
        // Mostrar loading
        const avatarContainer = document.querySelector('.user-avatar');
        const originalContent = avatarContainer.innerHTML;
        avatarContainer.innerHTML = '<i class="fas fa-spinner fa-spin" style="font-size: 40px; color: white;"></i>';
        
        fetch('{% url "administradores:subir_avatar" %}', {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Mostrar mensaje de éxito
                showMessage('Imagen de perfil actualizada exitosamente.', 'success');
                
                // Refrescar la página después de 1.5 segundos
                setTimeout(() => {
                    window.location.reload();
                }, 1200);
            } else {
                avatarContainer.innerHTML = originalContent;
                showMessage(data.message || 'Error al subir la imagen', 'error');
            }
        })
        .catch(error => {
            avatarContainer.innerHTML = originalContent;
            showMessage('Error de conexión. Inténtalo de nuevo.', 'error');
            console.error('Error:', error);
        });
    }
}

function showMessage(message, type = 'info', duration = 5000) {
    // Crear contenedor si no existe
    let messagesContainer = document.getElementById('dynamicMessagesContainer');
    if (!messagesContainer) {
        messagesContainer = document.createElement('div');
        messagesContainer.id = 'dynamicMessagesContainer';
        messagesContainer.className = 'messages-container';
        document.querySelector('.perfil-container').prepend(messagesContainer);
    }
    
    // Crear elemento del mensaje
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type}`;
    messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
        <span>${message}</span>
        <button class="message-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;
    
    // Añadir al contenedor
    messagesContainer.appendChild(messageDiv);
    
    // Animación de entrada
    setTimeout(() => {
        messageDiv.style.opacity = '1';
    }, 10);
    
    // Auto-eliminar después del tiempo especificado
    if (duration > 0) {
        setTimeout(() => {
            messageDiv.style.opacity = '0';
            messageDiv.style.transform = 'translateX(100px)';
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 300);
        }, duration);
    }
}
</script>














<script>
    // contraseñas:

    // ===== FUNCIONES PARA EL FORMULARIO DE CONTRASEÑA =====

// Función para alternar visibilidad de contraseña
function togglePasswordVisibility(inputId, button) {
    const input = document.getElementById(inputId);
    const icon = button.querySelector('i');
    
    if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        button.setAttribute('title', 'Ocultar contraseña');
    } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        button.setAttribute('title', 'Mostrar contraseña');
    }
    
    // Enfocar el input después de cambiar el tipo
    input.focus();
}

// Función para limpiar campos del formulario de contraseña
function resetPasswordForm() {
    const nuevaPassword = document.getElementById('nueva_password');
    const confirmarPassword = document.getElementById('confirmar_password');
    
    // Limpiar valores
    nuevaPassword.value = '';
    confirmarPassword.value = '';
    
    // Resetear estilos de validación
    nuevaPassword.style.borderColor = '';
    nuevaPassword.style.boxShadow = '';
    confirmarPassword.style.borderColor = '';
    confirmarPassword.style.boxShadow = '';
    
    // Restablecer iconos de visibilidad a "ojo cerrado"
    const toggleButtons = document.querySelectorAll('.password-toggle');
    toggleButtons.forEach(button => {
        const icon = button.querySelector('i');
        // Extraer el inputId del atributo onclick
        const onclickAttr = button.getAttribute('onclick');
        const match = onclickAttr.match(/'([^']+)'/);
        if (match) {
            const inputId = match[1];
            const input = document.getElementById(inputId);
            if (input) {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
                button.setAttribute('title', 'Mostrar contraseña');
            }
        }
    });
    
    // Mostrar confirmación
    if (confirm('¿Está seguro de que desea limpiar todos los campos de contraseña?')) {
        // Enfocar el primer campo
        nuevaPassword.focus();
    }
}

// Función para enviar formulario de contraseña
function submitPasswordForm() {
    const form = document.getElementById('passwordForm');
    const nuevaPassword = document.getElementById('nueva_password');
    const confirmarPassword = document.getElementById('confirmar_password');
    
    // Validaciones
    if (!nuevaPassword.value.trim() || !confirmarPassword.value.trim()) {
        alert('Ambos campos de contraseña son obligatorios.');
        nuevaPassword.focus();
        return;
    }
    
    if (nuevaPassword.value.length < 8) {
        alert('La contraseña debe tener al menos 8 caracteres.');
        nuevaPassword.focus();
        return;
    }
    
    // Validar caracteres especiales (opcional)
    const tieneMayuscula = /[A-Z]/.test(nuevaPassword.value);
    const tieneMinuscula = /[a-z]/.test(nuevaPassword.value);
    const tieneNumero = /[0-9]/.test(nuevaPassword.value);
    
    if (!tieneMayuscula || !tieneMinuscula || !tieneNumero) {
        alert('Para mayor seguridad, la contraseña debe contener:\n• Al menos una letra mayúscula\n• Al menos una letra minúscula\n• Al menos un número');
        nuevaPassword.focus();
        return;
    }
    
    if (nuevaPassword.value !== confirmarPassword.value) {
        alert('Las contraseñas no coinciden. Por favor, verifique que ambas contraseñas sean iguales.');
        confirmarPassword.focus();
        return;
    }
    
    // Confirmar antes de enviar
    if (confirm('¿Está seguro de que desea cambiar su contraseña?\n\nEsta acción no se puede deshacer.')) {
        // Deshabilitar botones mientras se procesa
        const cancelBtn = form.querySelector('.btn-cancel');
        const saveBtn = form.querySelector('.btn-save');
        
        if (saveBtn) {
            saveBtn.disabled = true;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Cambiando...';
        }
        if (cancelBtn) cancelBtn.disabled = true;
        
        // Enviar formulario
        form.submit();
    }
}

// Validación en tiempo real para coincidencia de contraseñas
function setupPasswordValidation() {
    const nuevaPassword = document.getElementById('nueva_password');
    const confirmarPassword = document.getElementById('confirmar_password');
    
    if (!nuevaPassword || !confirmarPassword) return;
    
    function validatePasswordMatch() {
        if (nuevaPassword.value && confirmarPassword.value) {
            if (nuevaPassword.value !== confirmarPassword.value) {
                confirmarPassword.style.borderColor = '#dc3545';
                confirmarPassword.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
            } else {
                confirmarPassword.style.borderColor = '#28a745';
                confirmarPassword.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.1)';
            }
        } else {
            confirmarPassword.style.borderColor = '';
            confirmarPassword.style.boxShadow = '';
        }
        
        // Validar fortaleza de contraseña
        if (nuevaPassword.value.length > 0) {
            if (nuevaPassword.value.length < 8) {
                nuevaPassword.style.borderColor = '#dc3545';
                nuevaPassword.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
            } else {
                nuevaPassword.style.borderColor = '#28a745';
                nuevaPassword.style.boxShadow = '0 0 0 3px rgba(40, 167, 69, 0.1)';
            }
        } else {
            nuevaPassword.style.borderColor = '';
            nuevaPassword.style.boxShadow = '';
        }
    }
    
    // Agregar event listeners
    nuevaPassword.addEventListener('input', validatePasswordMatch);
    confirmarPassword.addEventListener('input', validatePasswordMatch);
    
    // Agregar event listener para Enter key
    nuevaPassword.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            confirmarPassword.focus();
        }
    });
    
    confirmarPassword.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            submitPasswordForm();
        }
    });
}

// Función para añadir tooltips a los botones de visibilidad
function setupPasswordTooltips() {
    const toggleButtons = document.querySelectorAll('.password-toggle');
    toggleButtons.forEach(button => {
        button.setAttribute('title', 'Mostrar contraseña');
        
        // Añadir evento mouseover para tooltip
        button.addEventListener('mouseover', function() {
            this.style.cursor = 'pointer';
        });
    });
}

// Inicialización cuando el DOM está listo
document.addEventListener('DOMContentLoaded', function() {
    // Configurar validación de contraseñas
    setupPasswordValidation();
    
    // Configurar tooltips para botones de visibilidad
    setupPasswordTooltips();
    
    console.log('Módulo de contraseñas cargado');
});

// ===== FUNCIÓN AUXILIAR PARA MOSTRAR MENSAJES (opcional) =====
function showPasswordMessage(message, type = 'info') {
    // Eliminar mensajes anteriores
    const existingMessages = document.querySelectorAll('.password-message');
    existingMessages.forEach(msg => msg.remove());
    
    // Crear mensaje
    const messageDiv = document.createElement('div');
    messageDiv.className = `password-message ${type}`;
    messageDiv.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
        ${message}
    `;
    
    // Estilos básicos
    messageDiv.style.padding = '10px 15px';
    messageDiv.style.borderRadius = '5px';
    messageDiv.style.margin = '10px 0';
    messageDiv.style.display = 'flex';
    messageDiv.style.alignItems = 'center';
    messageDiv.style.gap = '10px';
    messageDiv.style.fontSize = '14px';
    
    if (type === 'success') {
        messageDiv.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
        messageDiv.style.color = '#28a745';
        messageDiv.style.border = '1px solid rgba(40, 167, 69, 0.3)';
    } else {
        messageDiv.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
        messageDiv.style.color = '#dc3545';
        messageDiv.style.border = '1px solid rgba(220, 53, 69, 0.3)';
    }
    
    // Insertar después del formulario de contraseña
    const passwordForm = document.getElementById('passwordForm');
    if (passwordForm) {
        passwordForm.parentNode.insertBefore(messageDiv, passwordForm.nextSibling);
        
        // Auto-eliminar después de 5 segundos
        setTimeout(() => {
            messageDiv.style.opacity = '0';
            messageDiv.style.transition = 'opacity 0.3s';
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 300);
        }, 5000);
    }
}
</script>

{% endblock %}